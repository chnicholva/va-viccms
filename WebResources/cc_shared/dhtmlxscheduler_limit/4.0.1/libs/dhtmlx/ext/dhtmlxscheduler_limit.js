/*
@license
dhtmlxScheduler v.4.3.1

This software is covered by DHTMLX Enterprise License. Usage without proper license is prohibited.

(c) Dinamenta, UAB.
*/
Scheduler.plugin(function(e){e.config.limit_start=null,e.config.limit_end=null,e.config.limit_view=!1,e.config.check_limits=!0,e.config.mark_now=!0,e.config.display_marked_timespans=!0,e._temp_limit_scope=function(){function t(t,a,n,r,i){var _=e,s=[],d={_props:"map_to",matrix:"y_property"};for(var o in d){var l=d[o];if(_[o])for(var f in _[o]){var m=_[o][f],c=m[l];t[c]&&(s=_._add_timespan_zones(s,e._get_blocked_zones(a[f],t[c],n,r,i)))}}return s=_._add_timespan_zones(s,e._get_blocked_zones(a,"global",n,r,i))}var a=null,n="dhx_time_block",r="default",i=function(e,t,a){return t instanceof Date&&a instanceof Date?(e.start_date=t,e.end_date=a):(e.days=t,e.zones=a),e},_=function(e,t,a){var r="object"==typeof e?e:{days:e};return r.type=n,r.css="",t&&(a&&(r.sections=a),r=i(r,e,t)),r};e.blockTime=function(t,a,n){var r=_(t,a,n);return e.addMarkedTimespan(r)},e.unblockTime=function(t,a,n){a=a||"fullday";var r=_(t,a,n);return e.deleteMarkedTimespan(r)},e.attachEvent("onBeforeViewChange",function(t,a,n,r){function i(t,a){var n=e.config.limit_start,r=e.config.limit_end,i=e.date.add(t,1,a);return t.valueOf()>r.valueOf()||i<=n.valueOf()}return e.config.limit_view&&(r=r||a,n=n||t,i(r,n)&&a.valueOf()!=r.valueOf())?(setTimeout(function(){var t=i(a,n)?e.config.limit_start:a;e.setCurrentView(i(t,n)?null:t,n)},1),!1):!0}),e.checkInMarkedTimespan=function(a,n,i){n=n||r;for(var _=!0,s=new Date(a.start_date.valueOf()),d=e.date.add(s,1,"day"),o=e._marked_timespans;s<a.end_date;s=e.date.date_part(d),d=e.date.add(s,1,"day")){var l=+e.date.date_part(new Date(s)),f=s.getDay(),m=t(a,o,f,l,n);if(m)for(var c=0;c<m.length;c+=2){var p=e._get_zone_minutes(s),h=a.end_date>d||a.end_date.getDate()!=s.getDate()?1440:e._get_zone_minutes(a.end_date),u=m[c],v=m[c+1];if(h>u&&v>p&&(_="function"==typeof i?i(a,p,h,u,v):!1,!_))break}}return!_};var s=e.checkLimitViolation=function(t){if(!t)return!0;if(!e.config.check_limits)return!0;var a=e,r=a.config,i=[];if(t.rec_type)for(var _=e.getRecDates(t),s=0;s<_.length;s++){var d=e._copy_event(t);e._lame_copy(d,_[s]),i.push(d)}else i=[t];for(var o=!0,l=0;l<i.length;l++){var f=!0,d=i[l];d._timed=e.isOneDayEvent(d),f=r.limit_start&&r.limit_end?d.start_date.valueOf()>=r.limit_start.valueOf()&&d.end_date.valueOf()<=r.limit_end.valueOf():!0,f&&(f=!e.checkInMarkedTimespan(d,n,function(e,t,n,r,i){var _=!0;return i>=t&&t>=r&&((1440==i||i>n)&&(_=!1),e._timed&&a._drag_id&&"new-size"==a._drag_mode?(e.start_date.setHours(0),e.start_date.setMinutes(i)):_=!1),(n>=r&&i>n||r>t&&n>i)&&(e._timed&&a._drag_id&&"new-size"==a._drag_mode?(e.end_date.setHours(0),e.end_date.setMinutes(r)):_=!1),_})),f||(f=a.checkEvent("onLimitViolation")?a.callEvent("onLimitViolation",[d.id,d]):f),o=o&&f}return o||(a._drag_id=null,a._drag_mode=null),o};e._get_blocked_zones=function(e,t,a,n,r){var i=[];if(e&&e[t])for(var _=e[t],s=this._get_relevant_blocked_zones(a,n,_,r),d=0;d<s.length;d++)i=this._add_timespan_zones(i,s[d].zones);return i},e._get_relevant_blocked_zones=function(e,t,a,n){var r=a[t]&&a[t][n]?a[t][n]:a[e]&&a[e][n]?a[e][n]:[];return r},e.attachEvent("onMouseDown",function(e){return!(e==n)}),e.attachEvent("onBeforeDrag",function(t){return t?s(e.getEvent(t)):!0}),e.attachEvent("onClick",function(t,a){return s(e.getEvent(t))}),e.attachEvent("onBeforeLightbox",function(t){var n=e.getEvent(t);return a=[n.start_date,n.end_date],s(n)}),e.attachEvent("onEventSave",function(t,a,n){if(!a.start_date||!a.end_date){var r=e.getEvent(t);a.start_date=new Date(r.start_date),a.end_date=new Date(r.end_date)}if(a.rec_type){var i=e._lame_clone(a);return e._roll_back_dates(i),s(i)}return s(a)}),e.attachEvent("onEventAdded",function(t){if(!t)return!0;var a=e.getEvent(t);return!s(a)&&e.config.limit_start&&e.config.limit_end&&(a.start_date<e.config.limit_start&&(a.start_date=new Date(e.config.limit_start)),a.start_date.valueOf()>=e.config.limit_end.valueOf()&&(a.start_date=this.date.add(e.config.limit_end,-1,"day")),a.end_date<e.config.limit_start&&(a.end_date=new Date(e.config.limit_start)),a.end_date.valueOf()>=e.config.limit_end.valueOf()&&(a.end_date=this.date.add(e.config.limit_end,-1,"day")),a.start_date.valueOf()>=a.end_date.valueOf()&&(a.end_date=this.date.add(a.start_date,this.config.event_duration||this.config.time_step,"minute")),a._timed=this.isOneDayEvent(a)),!0}),e.attachEvent("onEventChanged",function(t){if(!t)return!0;var n=e.getEvent(t);if(!s(n)){if(!a)return!1;n.start_date=a[0],n.end_date=a[1],n._timed=this.isOneDayEvent(n)}return!0}),e.attachEvent("onBeforeEventChanged",function(e,t,a){return s(e)}),e.attachEvent("onBeforeEventCreated",function(t){var a=e.getActionData(t).date,n={_timed:!0,start_date:a,end_date:e.date.add(a,e.config.time_step,"minute")};return s(n)}),e.attachEvent("onViewChange",function(){e._mark_now()}),e.attachEvent("onSchedulerResize",function(){return window.setTimeout(function(){e._mark_now()},1),!0}),e.attachEvent("onTemplatesReady",function(){e._mark_now_timer=window.setInterval(function(){e._is_initialized()&&e._mark_now()},6e4)}),e._mark_now=function(t){var a="dhx_now_time";this._els[a]||(this._els[a]=[]);var n=e._currentDate(),r=this.config;if(e._remove_mark_now(),!t&&r.mark_now&&n<this._max_date&&n>this._min_date&&n.getHours()>=r.first_hour&&n.getHours()<r.last_hour){var i=this.locate_holder_day(n);this._els[a]=e._append_mark_now(i,n)}},e._append_mark_now=function(t,a){var n="dhx_now_time",r=e._get_zone_minutes(a),i={zones:[r,r+1],css:n,type:n};if(!this._table_view){if(this._props&&this._props[this._mode]){for(var _=this._props[this._mode],s=_.size||_.options.length,d=t*s,o=(t+1)*s,l=(this._els.dhx_cal_data[0].childNodes,[]),f=d;o>f;f++){var m=f;i.days=m;var c=e._render_marked_timespan(i,null,m)[0];l.push(c)}return l}return i.days=t,e._render_marked_timespan(i,null,t)}return"month"==this._mode?(i.days=+e.date.date_part(a),e._render_marked_timespan(i,null,null)):void 0},e._remove_mark_now=function(){for(var e="dhx_now_time",t=this._els[e],a=0;a<t.length;a++){var n=t[a],r=n.parentNode;r&&r.removeChild(n)}this._els[e]=[]},e._marked_timespans={global:{}},e._get_zone_minutes=function(e){return 60*e.getHours()+e.getMinutes()},e._prepare_timespan_options=function(t){var a=[],n=[];if("fullweek"==t.days&&(t.days=[0,1,2,3,4,5,6]),t.days instanceof Array){for(var i=t.days.slice(),_=0;_<i.length;_++){var s=e._lame_clone(t);s.days=i[_],a.push.apply(a,e._prepare_timespan_options(s))}return a}if(!t||!(t.start_date&&t.end_date&&t.end_date>t.start_date||void 0!==t.days&&t.zones))return a;var d=0,o=1440;"fullday"==t.zones&&(t.zones=[d,o]),t.zones&&t.invert_zones&&(t.zones=e.invertZones(t.zones)),t.id=e.uid(),t.css=t.css||"",t.type=t.type||r;var l=t.sections;if(l){for(var f in l)if(l.hasOwnProperty(f)){var m=l[f];m instanceof Array||(m=[m]);for(var _=0;_<m.length;_++){var c=e._lame_copy({},t);c.sections={},c.sections[f]=m[_],n.push(c)}}}else n.push(t);for(var p=0;p<n.length;p++){var h=n[p],u=h.start_date,v=h.end_date;if(u&&v)for(var g=e.date.date_part(new Date(u)),y=e.date.add(g,1,"day");v>g;){var c=e._lame_copy({},h);delete c.start_date,delete c.end_date,c.days=g.valueOf();var k=u>g?e._get_zone_minutes(u):d,w=v>y||v.getDate()!=g.getDate()?o:e._get_zone_minutes(v);c.zones=[k,w],a.push(c),g=y,y=e.date.add(y,1,"day")}else h.days instanceof Date&&(h.days=e.date.date_part(h.days).valueOf()),h.zones=t.zones.slice(),a.push(h)}return a},e._get_dates_by_index=function(t,a,n){var r=[];a=e.date.date_part(new Date(a||e._min_date)),n=new Date(n||e._max_date);for(var i=a.getDay(),_=t-i>=0?t-i:7-a.getDay()+t,s=e.date.add(a,_,"day");n>s;s=e.date.add(s,1,"week"))r.push(s);return r},e._get_css_classes_by_config=function(e){var t=[];return e.type==n&&(t.push(n),e.css&&t.push(n+"_reset")),t.push("dhx_marked_timespan",e.css),t.join(" ")},e._get_block_by_config=function(e){var t=document.createElement("DIV");return e.html&&("string"==typeof e.html?t.innerHTML=e.html:t.appendChild(e.html)),t},e._render_marked_timespan=function(t,a,n){var r=[],i=e.config,_=this._min_date,s=this._max_date,d=!1;if(!i.display_marked_timespans)return r;if(!n&&0!==n){if(t.days<7)n=t.days;else{var o=new Date(t.days);if(d=+o,!(+s>+o&&+o>=+_))return r;n=o.getDay()}var l=_.getDay();l>n?n=7-(l-n):n-=l}var f=t.zones,m=e._get_css_classes_by_config(t);if(e._table_view&&"month"==e._mode){var c=[],p=[];if(a)c.push(a),p.push(n);else{p=d?[d]:e._get_dates_by_index(n);for(var h=0;h<p.length;h++)c.push(this._scales[p[h]])}for(var h=0;h<c.length;h++){a=c[h],n=p[h];var u=Math.floor((this._correct_shift(n,1)-_.valueOf())/(864e5*this._cols.length)),v=this.locate_holder_day(n,!1)%this._cols.length;if(!this._ignores[v]){var g=e._get_block_by_config(t),y=Math.max(a.offsetHeight-1,0),k=Math.max(a.offsetWidth-1,0),w=this._colsS[v],z=this._colsS.heights[u]+(this._colsS.height?this.xy.month_scale_height+2:2)-1;g.className=m,g.style.top=z+"px",g.style.lineHeight=g.style.height=y+"px";for(var b=0;b<f.length;b+=2){var D=f[h],x=f[h+1];if(D>=x)return[];var E=g.cloneNode(!0);E.style.left=w+Math.round(D/1440*k)+"px",E.style.width=Math.round((x-D)/1440*k)+"px",a.appendChild(E),r.push(E)}}}}else{var O=n;if(this._ignores[this.locate_holder_day(n,!1)])return r;if(this._props&&this._props[this._mode]&&t.sections&&t.sections[this._mode]){var M=this._props[this._mode];O=M.order[t.sections[this._mode]];var T=M.order[t.sections[this._mode]];if(M.days>1){var C=M.size||M.options.length;O=O*C+T}else O=T,M.size&&O>M.position+M.size&&(O=0)}a=a?a:e.locate_holder(O);for(var h=0;h<f.length;h+=2){var D=Math.max(f[h],60*i.first_hour),x=Math.min(f[h+1],60*i.last_hour);if(D>=x){if(h+2<f.length)continue;return[]}var E=e._get_block_by_config(t);E.className=m;var N=24*this.config.hour_size_px+1,H=36e5;E.style.top=Math.round((60*D*1e3-this.config.first_hour*H)*this.config.hour_size_px/H)%N+"px",E.style.lineHeight=E.style.height=Math.max(Math.round(60*(x-D)*1e3*this.config.hour_size_px/H)%N,1)+"px",a.appendChild(E),r.push(E)}}return r},e.markTimespan=function(t){var a=[],n=!1;this._els.dhx_cal_data||(e.get_elements(),n=!0);var r=this._els.dhx_cal_data[0],i=e._marked_timespans_ids,_=e._marked_timespans_types,s=e._marked_timespans;e.deleteMarkedTimespan(),e.addMarkedTimespan(t);for(var d=new Date(e._min_date),o=0,l=r.childNodes.length;l>o;o++){var f=r.childNodes[o];f.firstChild&&(f.firstChild.className||"").indexOf("dhx_scale_hour")>-1||(a.push.apply(a,e._on_scale_add_marker(f,d)),d=e.date.add(d,1,"day"))}return n&&(e._els=[]),e._marked_timespans_ids=i,e._marked_timespans_types=_,e._marked_timespans=s,a},e.unmarkTimespan=function(e){if(e)for(var t=0;t<e.length;t++){var a=e[t];a.parentNode&&a.parentNode.removeChild(a)}},e._marked_timespans_ids={},e.addMarkedTimespan=function(t){var a=e._prepare_timespan_options(t),n="global";if(a.length){var r=a[0].id,i=e._marked_timespans,_=e._marked_timespans_ids;_[r]||(_[r]=[]);for(var s=0;s<a.length;s++){var d=a[s],o=d.days,l=(d.zones,d.css,d.sections),f=d.type;if(d.id=r,l){for(var m in l)if(l.hasOwnProperty(m)){i[m]||(i[m]={});var c=l[m],p=i[m];p[c]||(p[c]={}),p[c][o]||(p[c][o]={}),p[c][o][f]||(p[c][o][f]=[],e._marked_timespans_types||(e._marked_timespans_types={}),e._marked_timespans_types[f]||(e._marked_timespans_types[f]=!0));var h=p[c][o][f];d._array=h,h.push(d),_[r].push(d)}}else{i[n][o]||(i[n][o]={}),i[n][o][f]||(i[n][o][f]=[]),e._marked_timespans_types||(e._marked_timespans_types={}),e._marked_timespans_types[f]||(e._marked_timespans_types[f]=!0);var h=i[n][o][f];d._array=h,h.push(d),_[r].push(d)}}return r}},e._add_timespan_zones=function(e,t){var a=e.slice();if(t=t.slice(),!a.length)return t;for(var n=0;n<a.length;n+=2)for(var r=a[n],i=a[n+1],_=n+2==a.length,s=0;s<t.length;s+=2){var d=t[s],o=t[s+1];if(o>i&&i>=d||r>d&&o>=r)a[n]=Math.min(r,d),a[n+1]=Math.max(i,o),n-=2;else{if(!_)continue;var l=r>d?0:2;a.splice(n+l,0,d,o)}t.splice(s--,2);break}return a},e._subtract_timespan_zones=function(e,t){for(var a=e.slice(),n=0;n<a.length;n+=2)for(var r=a[n],i=a[n+1],_=0;_<t.length;_+=2){var s=t[_],d=t[_+1];if(d>r&&i>s){var o=!1;r>=s&&d>=i&&a.splice(n,2),s>r&&(a.splice(n,2,r,s),o=!0),i>d&&a.splice(o?n+2:n,o?0:2,d,i),n-=2;break}}return a},e.invertZones=function(t){return e._subtract_timespan_zones([0,1440],t.slice())},e._delete_marked_timespan_by_id=function(t){var a=e._marked_timespans_ids[t];if(a)for(var n=0;n<a.length;n++)for(var r=a[n],i=r._array,_=0;_<i.length;_++)if(i[_]==r){i.splice(_,1);break}},e._delete_marked_timespan_by_config=function(t){var a=e._marked_timespans,n=t.sections,i=t.days,_=t.type||r,s=[];if(n){for(var d in n)if(n.hasOwnProperty(d)&&a[d]){var o=n[d];a[d][o]&&a[d][o][i]&&a[d][o][i][_]&&(s=a[d][o][i][_])}}else a.global[i]&&a.global[i][_]&&(s=a.global[i][_]);for(var l=0;l<s.length;l++){var f=s[l],m=e._subtract_timespan_zones(f.zones,t.zones);if(m.length)f.zones=m;else{s.splice(l,1),l--;for(var c=e._marked_timespans_ids[f.id],p=0;p<c.length;p++)if(c[p]==f){c.splice(p,1);break}}}for(var l in e._marked_timespans.timeline)for(var h in e._marked_timespans.timeline[l])for(var p in e._marked_timespans.timeline[l][h])p===_&&delete e._marked_timespans.timeline[l][h][p]},e.deleteMarkedTimespan=function(t){if(arguments.length||(e._marked_timespans={global:{}},e._marked_timespans_ids={},e._marked_timespans_types={}),"object"!=typeof t)e._delete_marked_timespan_by_id(t);else{t.start_date&&t.end_date||(t.days||(t.days="fullweek"),t.zones||(t.zones="fullday"));var a=[];if(t.type)a.push(t.type);else for(var n in e._marked_timespans_types)a.push(n);for(var r=e._prepare_timespan_options(t),i=0;i<r.length;i++)for(var _=r[i],s=0;s<a.length;s++){var d=e._lame_clone(_);d.type=a[s],e._delete_marked_timespan_by_config(d)}}},e._get_types_to_render=function(e,t){var a=e?e:{};for(var n in t||{})t.hasOwnProperty(n)&&(a[n]=t[n]);return a},e._get_configs_to_render=function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push.apply(t,e[a]);return t},e._on_scale_add_marker=function(t,a){if(!e._table_view||"month"==e._mode){var n=a.getDay(),r=a.valueOf(),i=this._mode,_=e._marked_timespans,s=[],d=[];if(this._props&&this._props[i]){var o=this._props[i],l=o.options,f=e._get_unit_index(o,a),m=l[f];if(o.days>1){var c=864e5,p=Math.floor((a-e._min_date)/c);a=e.date.add(e._min_date,Math.floor(p/l.length),"day"),a=e.date.date_part(a)}else a=e.date.date_part(new Date(this._date));if(n=a.getDay(),r=a.valueOf(),_[i]&&_[i][m.key]){var h=_[i][m.key],u=e._get_types_to_render(h[n],h[r]);s.push.apply(s,e._get_configs_to_render(u))}}var v=_.global,g=v[r]||v[n];s.push.apply(s,e._get_configs_to_render(g));for(var y=0;y<s.length;y++)d.push.apply(d,e._render_marked_timespan(s[y],t,a));return d}},e.attachEvent("onScaleAdd",e._on_scale_add_marker),e.dblclick_dhx_marked_timespan=function(t,a){e.config.dblclick_create||e.callEvent("onScaleDblClick",[e.getActionData(t).date,a,t]),e.addEventNow(e.getActionData(t).date,null,t)}},e._temp_limit_scope()});